<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>QR Player</title>
<style>
:root{--a:#ff0066;--b:#0b0b0b;--c:#1a1a1a;--m:#9aa0a6}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;font:16px/1.5 Inter,sans-serif;background:var(--b);color:#fff;display:flex;justify-content:center;align-items:center}
.wrap{max-width:420px;width:100%;padding:16px}
.p{background:var(--c);border-radius:16px;padding:16px;box-shadow:0 8px 30px #0006;display:flex;flex-direction:column;gap:12px}
audio{width:100%;border-radius:8px;outline:0}
#r{width:100%;aspect-ratio:4/3;background:#000;border-radius:10px;overflow:hidden;display:none;align-items:center;justify-content:center}
button{background:var(--a);border:0;padding:12px 20px;border-radius:10px;color:#fff;font-size:16px;cursor:pointer;transition:.2s}
button:hover{background:#ff3385}
.i{display:flex;gap:8px;margin-top:8px}
input[type=number]{flex:1;padding:10px;border-radius:10px 0 0 10px;border:0;font-size:16px;outline:0}
#t{text-align:center;font-weight:600}
#e{text-align:center;color:var(--a);font-size:14px}
@media(max-width:460px){.p{padding:12px;border-radius:12px}button,input{font-size:15px;padding:10px}}
</style>
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body>
<div class="wrap">
<div class="p">
<audio id="a" controls crossorigin="anonymous"></audio>
<div class="i"><input id="i" type="number" placeholder="ID трека"><button id="pb" disabled>Play</button></div>
<div id="t"></div><div id="e"></div>
<div id="r"></div><button id="sb" disabled>Camera</button>
<div style="text-align:center;font-size:13px;margin-top:8px;color:var(--m)">Google Sheet (opensheet.elk.sh)</div>
</div>
</div>
<script>
const u='https://opensheet.elk.sh/1tOIw1bHa4pd1XiYL_JymSCLo5AtMkpf1sGfMrYP8Tys/%D1%82%D1%80%D0%B5%D0%BA%D0%B8',t=[],a=document.getElementById('a'),i=document.getElementById('i'),pb=document.getElementById('pb'),sb=document.getElementById('sb'),tt=document.getElementById('t'),ee=document.getElementById('e'),r=document.getElementById('r');
function err(m){ee.textContent=m;setTimeout(()=>{if(ee.textContent===m)ee.textContent=''},4000)}
async function load(){try{const x=await fetch(u);const d=await x.json();t.length=0;t.push(...d);pb.disabled=sb.disabled=false}catch(e){err('Load error');console.error(e)}}
function play(id=null){const v=id?String(id).trim():i.value.trim();tt.textContent=ee.textContent='';if(!t.length)return err('Loading...');const tr=t.find(x=>String(x.id).trim()===v);if(tr){const src=tr.url?.trim();if(!src)return err('No URL');a.src=src;a.load();a.play().catch(e=>err('Play blocked: '+e.message));tt.textContent=(tr.Наименование||`Track #${v}`).trim()}else err('Not found')}
pb.onclick=()=>play();
window.addEventListener('load',()=>{load();if(typeof Html5Qrcode==='undefined')return err('Scanner missing');sb.onclick=()=>{r.style.display='flex';sb.style.display='none';const q=new Html5Qrcode('r');q.start({facingMode:'environment'},{fps:10,qrbox:{width:Math.min(r.clientWidth,300),height:Math.min(r.clientWidth,300)},formatsToSupport:[Html5QrcodeSupportedFormats.QR_CODE]},d=>{play(d);q.stop().then(()=>q.clear())},()=>{}).catch(e=>err('Camera: '+(e.name||e)))}});
</script>
</body>
</html>
